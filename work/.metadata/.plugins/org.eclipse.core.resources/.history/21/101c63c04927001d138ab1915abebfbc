package com.exe.springJdbcTemplate;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import javax.sql.DataSource;

import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.RowMapper;

public class CustomDAO2 {

	private JdbcTemplate jdbcTemplate;

	public void setJdbcTemplate(JdbcTemplate jdbcTemplate) {
		this.jdbcTemplate = jdbcTemplate;
	}

	public void insertData(CustomDTO dto) {

		StringBuilder sql = new StringBuilder();

		sql.append("insert into custom (id, name, age) values(?, ?, ?)");

		//스프링에서 jdbc 사용법
		jdbcTemplate.update(sql.toString(), dto.getId(), dto.getName(), dto.getAge());

	}

	public List<CustomDTO> getList(){

		StringBuilder sql = new StringBuilder();

		sql.append("select id, name, age from custom");

		List<CustomDTO> lists = jdbcTemplate.query(sql.toString(), 
				new RowMapper<CustomDTO>() {

			public CustomDTO mapRow(ResultSet rs, int rowNum) throws SQLException {
				CustomDTO dto = new CustomDTO();

				dto.setId(rs.getInt("id"));
				dto.setName(rs.getString("name"));
				dto.setAge(rs.getInt("age"));
				return dto;
			}

		});

		return lists;

	}

	public CustomDTO getReadData(int id){

		StringBuilder sql = new StringBuilder();
		
		sql.append("select id, name, age from custom where id = ?");


		CustomDTO dtoOne = jdbcTemplate.queryForObject(sql.toString(), new RowMapper<CustomDTO>() {

			public CustomDTO mapRow(ResultSet rs, int rowNum) throws SQLException {
				CustomDTO dto = new CustomDTO();
				
				dto.setId(rs.getInt("id"));
				dto.setName(rs.getString("name"));
				dto.setAge(rs.getInt("age"));
				return dto;
			}
			
		}, id);

		return dtoOne;
		
	}



	public void updateData(CustomDTO dto) {
		
		StringBuilder sql = new StringBuilder();
		
			sql = "update custom set name = ?, age = ? where id = ?";
		
	}


	public int deleteData(int id) {
		int result = 0;
		PreparedStatement pstmt = null;
		String sql;

		try {

			conn = dataSource.getConnection();

			sql = "delete custom where id = ?";

			pstmt = conn.prepareStatement(sql);

			pstmt.setInt(1, id);

			result = pstmt.executeUpdate();

			pstmt.close();


		} catch (Exception e) {
			System.out.println(e.toString());
		}

		return result;
	}





















}
